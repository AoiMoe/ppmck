ppmck release 9a ex10 by BouKiCHi

**** このファイルについて

　ppmck release9aを改変したものです。

　ppmckの機能と以下の機能が利用可能です。

・NSF再生時の過負荷の検出と抑制
・エフェクトデータのバンク切り替え
・スラー機能(トラックABC & N106 & VRC6 & VRC7 & MMC5)
・発音時のトリガー発生を若干抑える機能(トラックABC)
・ポルタメント(トラックABC)
・ハードウェアエンベロープ機能（トラックABF & ノイズ & MMC5 ）
・過負荷処理・検出
・VRC7音色定義 @OT
・タイムシフト機能(9a ex7)
・マルチスラー機能(9a ex7.2)

・新しいポルタメント記号(9a ex8)
・@qの拡張(9a ex8)

・#DEFINEの追加(9a ex9)
・FRAMEOVER_NOSKIPの追加(9a ex9)
・FDS音源 MOD周波数の設定(9a ex9)

・@@、@@rをFME7(S5B)で有効にした(9a ex10)

***** @@、@@rをFME7(S5B)で有効にした(9a ex10)

FME7でも@@を音色エンベロープとして有効にしました。

***** #DEFINEの追加(9a ex9)

ppmckのコンパイル時に任意の定義を伝えることで、
機能を有効にできるようになります。（上級者向け機能）

***** FRAMEOVER_NOSKIPの追加(9a ex9)

フレームオーバーのバグを再現する謎機能です(上級者向け)

#define FRAMEOVER_NOSKIP

とします。


***** FDS音源 MOD周波数の設定(9a ex9)

モジュレータの周波数を設定します。

MF<freq> : 0 <= freq < 4096

例:
F MF1000


***** @qの拡張(9a ex8)
@q<num>[,min]
となりました。
minは最低発音時間で、省略時は内部的に1になります。
@q10,2などと出来ます。


***** ポルタメント記号(9a ex8)
現時点ではPSの記号を_に変更したのみです。
トラックABCのみ利用可能

A v15 c_d

と表記できるようになりました。


***** マルチスラー機能(9a ex7.2)
スラーを複数繋げます。
例:
; A c&d&eと等価
A (cde)

***** タイムシフト機能(9a ex7)
ひとつのトラックの場所に!!を挿入すると
すべてのトラックがその時間(カウント数)からの再生になります。

例:
A cde !! fgab

**** @OT音色定義

VRC7の音色定義として、@OTを実装しました。
フォーマットはMGSDRVの音色定義と同等です。

**** 過負荷処理・検出

1フレームあたりの処理能力を超過した場合に処理・検出する機能です。

#OVERLOAD_DETECTを使用することで過負荷検出が可能になります。
演奏が発音状態のまま停止され、ビープ音が断続的に出力されます。

過負荷検出を使用しない場合は過負荷状態が発生した場合、
次のフレームを待たずに処理することで発音タイミングを合わせます。
最大254フレームの遅延に対応します。

**** エフェクトデータのバンク切り替え

　エフェクトデータが一定以上あり、自動バンク切り替えが有効な場合、
エフェクトデータ用に新しいバンクを用意します。
自動的にサイズを計算し、ボリュームエンベロープとピッチエンベロープなど、
定義毎にバンクを割り振ります。

エフェクトバンク切り替えが正しく判定できない場合、
「#EFFECT-BANKSWITCH」
を利用することで、手動で有効にすることができます。

**** スラーについて
　ex版でのスラーは、キーオフ、エフェクトテーブルの初期化をせずに、
次のノートに進む機能です。発音周波数のみが変更されます。

ex 7.1でクオンタイズ時の挙動が変更されました。

ppmck内部ではクオンタイズ機能の"q"と"@q"は内部的に同じ仕組みを利用していて、
コンパイラ内部によりゲートタイムを算出するため、音階以外にはクオンタイズ機能は
有効になりません。(現時点での仕様)

 kコマンド(キーオフ) → リリースへ
 rコマンド(休符) →　通常の休符に移行
 wコマンド(フレーム数加算) → 現在の状態を維持する。wコマンドはまとめて圧縮される。
 音階と上記コマンドをつなげると音階のゲートは無効になります。

**** 使い方

    1. ppmck release 9aをこのパッケージにあるファイルで置き換える
    2. mmlでスラー(&)を使って楽しむ。


 @v0 = { 15,14,13,10,6,5 }
 A o4 @v0 @2
 A c c&g g


とすると効果を確認できます。

また、

 A SM cdefg SMOF

とすると、SMからSMOFまでがスムースな発音になります。


    3.ポルタメントもどきを使う

  A c PS g PS c

などとすると、ピッチの上下を楽しむことができます。
ただし、PSコマンド後の音程は正確ではありませんので、
正確な音程を望むにはノートによる再発音が必要になります。


    4.ハードウェアエンベロープ

EHコマンド
指定の後、必ずduty設定を行うこと（有効にならない)
ボリューム設定でエンベロープのディケイレートを指定できる
EHx,y

x : 1でエンベロープを有効に
y : 0でエンベロープのループ

例:

 A EH1,1 @4 cdefgab>c
